<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue、react 推荐 | JessibucaPro Doc</title>
    <meta name="description" content="一款纯H5直播流播放器">
    <link rel="stylesheet" href="/assets/style.e3f468c3.css">
    <link rel="modulepreload" href="/assets/plugin-vue_export-helper.2d87e7a1.js">
    <link rel="modulepreload" href="/assets/Home.6a91b213.js">
    <link rel="modulepreload" href="/assets/doc.md.b82c37fa.lean.js">
    <link rel="modulepreload" href="/assets/app.6846a517.js">
    <meta name="twitter:title" content="vue、react 推荐 | JessibucaPro Doc">
    <meta property="og:title" content="vue、react 推荐 | JessibucaPro Doc">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="JessibucaPro Doc, back to home" data-v-40587210 data-v-7ac13a1e><!----> JessibucaPro Doc</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-640fc9fc><!--[--><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/api.html" data-v-49fe041d>API <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>更多API</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/playback-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>playback-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/audio-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>audio-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/multi-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>multi-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/talk-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>talk-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/ai-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>ai-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>业务方案</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/doc.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音视频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-playback.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>回放流/录像流</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-audio.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-talk.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>语音通讯</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>问题解答</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音视频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-playback.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>回放流/录像流</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-audio.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-talk.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>语音通讯</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/upgrade.html" data-v-49fe041d>升级 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/build.html" data-v-49fe041d>项目打包 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/changelog.html" data-v-49fe041d>更新日志 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-640fc9fc><!--[--><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/api.html" data-v-49fe041d>API <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>更多API</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/playback-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>playback-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/audio-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>audio-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/multi-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>multi-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/talk-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>talk-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/ai-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>ai-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>业务方案</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/doc.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音视频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-playback.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>回放流/录像流</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-audio.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-talk.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>语音通讯</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>问题解答</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音视频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-playback.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>回放流/录像流</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-audio.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-talk.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>语音通讯</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/upgrade.html" data-v-49fe041d>升级 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/build.html" data-v-49fe041d>项目打包 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/changelog.html" data-v-49fe041d>更新日志 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-17c48e2f><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#vue、react-推荐">vue、react 推荐</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#vue">vue</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#react">react</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于硬解码或者video标签渲染自动播放">关于硬解码或者video标签渲染自动播放</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#解决方案">解决方案</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#💡推荐配置方案建议💡">💡推荐配置方案建议💡</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#小结">小结</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于解码（usemse、usewcs、wasm-simd-）优先级">关于解码（useMSE、useWCS、wasm(simd)）优先级</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#usemse">useMSE</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#usewcs">useWCS</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#wasm-wasm-simd">wasm\wasm(simd)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#优先级">优先级</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mse-wcs-在播放过程中解码报错的时候，不降级到wasm解码（仍然使用mse或者wcs解码）">mse(wcs) 在播放过程中解码报错的时候，不降级到wasm解码（仍然使用mse或者wcs解码）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#监听请求流的失效-404、403等-或者500报错">监听请求流的失效(404、403等)或者500报错</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#理解loadingtimeout-和-delaytimeout">理解loadingTimeout 和 delayTimeout</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#loadingtimeout">loadingTimeout</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#delaytimeout">delayTimeout</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于移动端（h5）切换网络的时候，播放器会触发什么事件。">关于移动端（H5）切换网络的时候，播放器会触发什么事件。</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#http请求-废弃">http请求(废弃)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#websocket请求-废弃">websocket请求(废弃)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#小结-1">小结</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于播放器延迟-超过延迟触发丢帧-设置">关于播放器延迟(超过延迟触发丢帧)设置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于网络延迟">关于网络延迟</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#会出现本身延迟很低，但是网络延迟数据却很大">会出现本身延迟很低，但是网络延迟数据却很大</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置低延迟（300ms）解决方案建议【直播流】">配置低延迟（300ms）解决方案建议【直播流】</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#崩溃日志上报">崩溃日志上报</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#页面最小化（切换tab）超时检测建议">页面最小化（切换tab）超时检测建议</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#播放地址首次就请求失败（非超时）">播放地址首次就请求失败（非超时）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#页面首次加载超时检测">页面首次加载超时检测</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#页面播放过程中超时检测">页面播放过程中超时检测</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#语音通讯集成">语音通讯集成</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#单视频播放">单视频播放</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#单音频播放">单音频播放</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#纯音频播放器">纯音频播放器</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置自定义底部ui按钮">配置自定义底部UI按钮</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置右键菜单">配置右键菜单</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#jessibuca-pro-js-decoder-pro-js-decoder-pro-simd-js-decoder-pro-wasm-decoder-pro-simd-wasm-文件想通过cdn加载">jessibuca-pro.js decoder-pro.js(decoder-pro-simd.js) decoder-pro.wasm(decoder-pro-simd.wasm)文件想通过CDN加载</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#最新版本">最新版本</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#限制js的使用域名和限制播放url的域名">限制js的使用域名和限制播放url的域名</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于自定义按钮和系统默认提供的按钮">关于自定义按钮和系统默认提供的按钮</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#解决方案：">解决方案：</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于性能面板">关于性能面板</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于日志输出">关于日志输出</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#播放的时候解除静音">播放的时候解除静音</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#苹果手机默认没有声音。">苹果手机默认没有声音。</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于水印">关于水印</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#全屏水印">全屏水印</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#局部水印">局部水印</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#动态水印">动态水印</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#幽灵水印">幽灵水印</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#使用那种标签渲染">使用那种标签渲染</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于视频录制">关于视频录制</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#关于录制mp4文件，并且要支持音频-视频">关于录制mp4文件，并且要支持音频+视频</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于出现绿屏或者花屏的时候">关于出现绿屏或者花屏的时候</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于音频引擎">关于音频引擎</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#worklet">worklet</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#script">script</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#active">active</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ptz-操作">ptz 操作</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#click">click</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mousedownandup">mouseDownAndUp</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置额外的按钮（更多方向、镜头、聚焦、光圈）">配置额外的按钮（更多方向、镜头、聚焦、光圈）</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#加密流播放">加密流播放</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于集成语音通讯">关于集成语音通讯</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#整体逻辑">整体逻辑</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#需要监听websocket的事件和调用send-方法">需要监听websocket的事件和调用send 方法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#手机端全屏">手机端全屏</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#多屏播放">多屏播放</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#gzip-压缩资源文件">gzip 压缩资源文件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#如何配置底部自定义按钮（事件）">如何配置底部自定义按钮（事件）</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#自定义按钮">自定义按钮</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#自定义事件">自定义事件</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#异步加载js文件">异步加载js文件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#如果业务层需要自己处理播放异常逻辑。">如果业务层需要自己处理播放异常逻辑。</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#多屏需求">多屏需求</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#如果不需要播放音频">如果不需要播放音频</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#只需要硬解码的话">只需要硬解码的话</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#理解-loadingtimeout-和-delaytimeout-和loadingtimeoutretryend-和-delaytimeoutretryend事件">理解 loadingTimeout 和 delayTimeout 和loadingTimeoutRetryEnd 和 delayTimeoutRetryEnd事件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_7-24小时播放需求（支持断网重连）">7*24小时播放需求（支持断网重连）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#如果需要重播-内部-或网络断开手动触发重播的时候画面停留在失败前最后一帧-支持配置是否显示loading画面">如果需要重播(内部)或网络断开手动触发重播的时候画面停留在失败前最后一帧(支持配置是否显示loading画面)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#如果是多屏需求（硬解码）">如果是多屏需求（硬解码）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#结合sei数据-currentpts事件-addcontenttocanvas-方法-实现给视频添加人脸或者物品打框子。">结合SEI数据+ currentPts事件+ addContentToCanvas()方法 实现给视频添加人脸或者物品打框子。</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#实时监听视频是否卡顿">实时监听视频是否卡顿</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#视频录制是否可以支持水印（图片，或者文字）">视频录制是否可以支持水印（图片，或者文字）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置分辨率，支持切换分辨率的时候切换播放地址。">配置分辨率，支持切换分辨率的时候切换播放地址。</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h2 id="vue、react-推荐"><a class="header-anchor" href="#vue、react-推荐" aria-hidden="true">#</a> vue、react 推荐</h2><h3 id="vue"><a class="header-anchor" href="#vue" aria-hidden="true">#</a> vue</h3><ol><li>推荐绑定在 <code>this</code> 上面，不推荐绑定在<code>data</code> 对象上面，不然会触发无效的事件监听。</li><li>或者在实例的时候，绑定在<code>data</code>上面的时候，命名的时候以 <code>_</code> 或者<code>$</code> 开头，这样也不会触发无效的事件监听。 在 <code>vue</code> 中</li></ol><blockquote><p>以 _ 或 $ 开头的属性将不会被组件实例代理，因为它们可能和 Vue 的内置属性、API 方法冲突。你必须以 this.$data._property 的方式访问它们。</p></blockquote><p>见： <a href="https://cn.vuejs.org/api/options-state.html#data" target="_blank" rel="noopener noreferrer">https://cn.vuejs.org/api/options-state.html#data</a></p><div class="language-vue"><pre><code>// 可以挂载在Vue上面
Vue.prototype.$player = new Jessibuca({

})
</code></pre></div><div class="language-vue"><pre><code>// 也可以挂载在 $options 上面
this.$options.jessibuca = new Jessibuca({

})
</code></pre></div><h4 id="什么时候初始化播放器"><a class="header-anchor" href="#什么时候初始化播放器" aria-hidden="true">#</a> 什么时候初始化播放器</h4><p>建议是在 <code>mounted</code> 生命周期里面初始化</p><blockquote><p>确保dom已经渲染出来了，再初始化播放器。</p></blockquote><h3 id="react"><a class="header-anchor" href="#react" aria-hidden="true">#</a> react</h3><p>推荐绑定在 <code>this</code> 上面，不推荐绑定在<code>state</code> 对象上面。</p><h2 id="关于硬解码或者video标签渲染自动播放"><a class="header-anchor" href="#关于硬解码或者video标签渲染自动播放" aria-hidden="true">#</a> 关于硬解码或者video标签渲染自动播放</h2><p>背景：用户希望打开页面的时候就直接自动播放视频（单屏或者多屏），但是浏览器的自动播放策略是，必须是用户手动触发了事件之后，才能自动播放。</p><p>会抛出<code>DOMException: play() failed because the user didn&#39;t interact with the document first. https://goo.gl/xX8pDD</code> 错误。</p><h3 id="解决方案"><a class="header-anchor" href="#解决方案" aria-hidden="true">#</a> 解决方案</h3><ol><li>添加一个交互事件，让用户手动触发下，再去播放视频。</li><li>使用<code>wcs</code>解码(在https环境下)，然后使用<code>canvas</code>标签渲染。</li><li>使用wasm(simd) 软解码，然后使用<code>canvas</code>标签渲染。</li></ol><h2 id="💡推荐配置方案建议💡"><a class="header-anchor" href="#💡推荐配置方案建议💡" aria-hidden="true">#</a> 💡推荐配置方案建议💡</h2><p>由于<code>mse</code>的兼容性比<code>wcs</code>要强，所以在<code>http</code> 或者<code>https</code> 环境下，都可以优先使用<code>mse</code>进行解码。</p><p>优先使用<code>mse/wcs</code>硬解码，如果不支持，降级到simd wasm解码,兜底使用wasm解码。</p><p>优先级 mse&gt; wcs&gt; simd wasm &gt; wasm</p><div class="language-"><pre><code>{
    useMSE: true,
    useWCS: true, // 依赖https环境
    useSIMD:true,
    autoWasm:true,// 自动降级到 wasm 模式
    isResize:false,// 拉伸全屏
    videoBuffer:1, // 缓冲时长
    videoBufferDelay:1, // 延迟时长（超过延迟会触发丢帧机制）
    demuxUseWorker:true // worker进程解封装数据
}
</code></pre></div><p>如果希望硬解码报错的时候不降级到软解码，并且不黑屏，不出现loading效果</p><blockquote><p>可能会播放过程中，存在流本身就会存在缺帧的情况（推流端没推完整），会导致mse或者wcs 解码报错。</p></blockquote><div class="language-"><pre><code>{
    replayUseLastFrameShow: true, // 重播使用上一帧显示
    replayShowLoadingIcon: false,// 重播显示loading
    decoderErrorAutoWasm: false, // 解码失败自动降级到 wasm 模式
}
</code></pre></div><h3 id="小结"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h3><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> isReplay <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> jessibuca <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JessibucaPro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">&#39;player-container&#39;</span><span class="token punctuation">,</span><span class="token comment">// 必传</span>
        <span class="token literal-property property">videoBuffer</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 单位秒，如果是内网环境，可以设置更低些，比如0.3</span>
        <span class="token literal-property property">videoBufferDelay</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 单位秒 , 当累计延迟超过这个，会触发丢帧。如果网络不稳定的情况，可以设置高些，比如2，增大延迟，减少丢帧。</span>
        <span class="token literal-property property">decoder</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 解码器地址，默认是请求根目录下面的 decoder-pro.js 文件。具体配置信息看api.html 下面的 decoder 参数配置。</span>
        <span class="token literal-property property">isResize</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 画面会拉伸铺满整个container容器</span>

        <span class="token comment">// 当需要调试代码的时候，测试和生产环境不推荐配置为true，会影响性能和增加内存。</span>
        <span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">debugLevel</span><span class="token operator">:</span> <span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span>

        <span class="token comment">// 硬解码</span>
        <span class="token literal-property property">useMSE</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">useWCS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 依赖https环境</span>

        <span class="token comment">// 硬解码不支持的时候降级到软解码，比如265解码不支持。</span>
        <span class="token literal-property property">autoWasm</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">useSIMD</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 优先使用simd wasm 解码，不支持会降级到wasm 解码</span>

        <span class="token comment">// 硬解码报错的时候，不降级到软解码，而是重置解码器，继续用硬解码播放。</span>
        <span class="token literal-property property">decoderErrorAutoWasm</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">demuxUseWorker</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 解封装数据使用worker进程,这样可以提升性能。</span>

        <span class="token comment">// 如果想在触发手动重播的时候（比如http 和ws 地址发生 错误或者断开，触发playFailedAndPaused事件，手动重置播放器的时候），不出现黑屏和loading的icon</span>
        <span class="token literal-property property">loadingIcon</span><span class="token operator">:</span> isReplay <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

        <span class="token comment">//当播放器·内部发生重置·播放的时候，不希望出现黑屏和loading的icon</span>
        <span class="token literal-property property">replayUseLastFrameShow</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 重播使用上一帧显示</span>
        <span class="token literal-property property">replayShowLoadingIcon</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">// 重播显示loading</span>



        <span class="token comment">// 加载地址超时</span>
        <span class="token literal-property property">loadingTimeout</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 单位秒</span>
        <span class="token literal-property property">loadingTimeoutReplay</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 超时重试</span>
        <span class="token literal-property property">loadingTimeoutReplayTimes</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 重试次数 ，如果想无限次重试，可以设置-1</span>

        <span class="token comment">// 播放过程中没有流数据触发的超时（流地址没有断开）</span>
        <span class="token literal-property property">heartTimeout</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 单位秒</span>
        <span class="token literal-property property">heartTimeoutReplay</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 超时重试</span>
        <span class="token literal-property property">heartTimeoutReplayTimes</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 重试次数 ，如果想无限次重试，可以设置-1</span>

        <span class="token comment">// 解除静音</span>
        <span class="token literal-property property">isNotMute</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动播放的情况下，是不会生效的，需要有交互的情况（浏览器认为的交互）下才会生效。</span>

        <span class="token comment">// 如果播放的地址是hls，且有265的情况下，推荐配置下这个参数</span>
       <span class="token comment">// supportHls265: true, // 支持hls265解码</span>

        <span class="token comment">// 如果贵公司的播放地址只能使用一次，因为播放器内部也会触发重播机制的,这个时候需要业务自己手动触发播放器的重播机制。</span>
        <span class="token comment">// playFailedAndReplay:true ,// 配置了这个参数，当播放器内部发生重播的时候，都会触发playFailedAndPaused事件，需要业务自己去做重播。</span>

        <span class="token comment">// 其他参数</span>
        <span class="token operator">...</span>options<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="关于解码（usemse、usewcs、wasm-simd-）优先级"><a class="header-anchor" href="#关于解码（usemse、usewcs、wasm-simd-）优先级" aria-hidden="true">#</a> 关于解码（useMSE、useWCS、wasm(simd)）优先级</h2><h3 id="usemse"><a class="header-anchor" href="#usemse" aria-hidden="true">#</a> useMSE</h3><p>使用的是浏览器提供的<code>MediaSource</code>接口，来进行解码。</p><ul><li>硬解码</li><li>兼容性好</li><li>ios safari不支持</li><li>支持H264和H265解码</li><li>支持http和https</li></ul><h3 id="usewcs"><a class="header-anchor" href="#usewcs" aria-hidden="true">#</a> useWCS</h3><p>使用的是<code>WebCodec</code>接口，来进行解码。</p><ul><li>硬解码</li><li>支持H264和H265解码</li><li>支持https</li><li>ios safari不支持</li><li>兼容性不如mse</li></ul><h3 id="wasm-wasm-simd"><a class="header-anchor" href="#wasm-wasm-simd" aria-hidden="true">#</a> wasm\wasm(simd)</h3><p>使用的是<code>webassembly</code>来进行解码。</p><ul><li>软解码</li><li>兼容性好</li><li>支持H264和H265解码</li><li>支持http和https</li></ul><blockquote><p>wasm(simd) 主要是只支持<code>simd</code>指令集的浏览器，比如<code>chrome</code>，<code>edge</code>，<code>safari</code>不支持。</p></blockquote><h3 id="优先级"><a class="header-anchor" href="#优先级" aria-hidden="true">#</a> 优先级</h3><p>如果同时配置了<code>useMSE:true</code>和<code>useWCS:true</code>，则优先使用<code>useMSE</code>，如果<code>useMSE</code>不支持，则使用<code>useWCS</code>，如果 <code>useWCS</code> 不支持，则会根据是否配置<code>useSIMD:true</code>降级到<code>wasm(simd)</code>解码，否则降级到<code>wasm</code>解码。</p><blockquote><p>useMSE &gt; useWCS &gt; wasm(simd) &gt; wasm</p></blockquote><h2 id="mse-wcs-在播放过程中解码报错的时候，不降级到wasm解码（仍然使用mse或者wcs解码）"><a class="header-anchor" href="#mse-wcs-在播放过程中解码报错的时候，不降级到wasm解码（仍然使用mse或者wcs解码）" aria-hidden="true">#</a> mse(wcs) 在播放过程中解码报错的时候，不降级到wasm解码（仍然使用mse或者wcs解码）</h2><blockquote><p>可能会播放过程中，存在流本身就会存在缺帧的情况（推流端没推完整），会导致mse或者wcs 解码报错。</p></blockquote><p>这边我们希望解码报错的时候，仍然使用mse或者wcs解码，而不是降级到wasm解码。</p><div class="language-"><pre><code>{
    mseDecodeErrorReplay:true, // 默认是true
    wcsDecodeErrorReplay:true, // 默认是true
    // autoWasm:false // 废弃了，不需要配置
    decoderErrorAutoWasm:false,
}
</code></pre></div><p>希望重置解码器的时候，不黑屏，不出现loading情况</p><div class="language-"><pre><code>{
    replayUseLastFrameShow: true, // 重播使用上一帧显示
    replayShowLoadingIcon: false,// 重播显示loading
}
</code></pre></div><h2 id="监听请求流的失效-404、403等-或者500报错"><a class="header-anchor" href="#监听请求流的失效-404、403等-或者500报错" aria-hidden="true">#</a> 监听请求流的失效(404、403等)或者500报错</h2><p>监听<a href="/api.html#playfailedandpaused">playFailedAndPaused</a>事件，来统一处理业务。</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;playFailedAndPaused&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">reason<span class="token punctuation">,</span> lastFrameInfo<span class="token punctuation">,</span>error</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="理解loadingtimeout-和-delaytimeout"><a class="header-anchor" href="#理解loadingtimeout-和-delaytimeout" aria-hidden="true">#</a> 理解loadingTimeout 和 delayTimeout</h2><h3 id="loadingtimeout"><a class="header-anchor" href="#loadingtimeout" aria-hidden="true">#</a> loadingTimeout</h3><p>loadingTimeout 是指在<code>播放器在请求url的时候</code>，接口是返回200状态码了，但是数据还迟迟没有推送给web端 ，如果在<code>loadingTimeout</code> 时间内，没有收到流数据，则会抛出<code>loadingTimeout</code>错误。</p><h3 id="delaytimeout"><a class="header-anchor" href="#delaytimeout" aria-hidden="true">#</a> delayTimeout</h3><p>delayTimeout 是指在<code>播放器播放过程中</code>，如果在<code>delayTimeout</code>时间内，没有收到流数据，则会抛出<code>delayTimeout</code>错误。</p><h2 id="关于移动端（h5）切换网络的时候，播放器会触发什么事件。"><a class="header-anchor" href="#关于移动端（h5）切换网络的时候，播放器会触发什么事件。" aria-hidden="true">#</a> 关于移动端（H5）切换网络的时候，播放器会触发什么事件。</h2><h3 id="http请求-废弃"><a class="header-anchor" href="#http请求-废弃" aria-hidden="true">#</a> http请求(废弃)</h3><p><s>会触发<code>fetchError</code>事件</s></p><p>通过监听<code>playFailedAndPaused</code>事件，来统一处理业务。</p><h3 id="websocket请求-废弃"><a class="header-anchor" href="#websocket请求-废弃" aria-hidden="true">#</a> websocket请求(废弃)</h3><p><s>会触发<code>websocketError</code>事件</s></p><p>通过监听<code>playFailedAndPaused</code>事件，来统一处理业务。</p><h3 id="小结-1"><a class="header-anchor" href="#小结-1" aria-hidden="true">#</a> 小结</h3><p><s>或者可以通过监听<code>error</code>错误事件，来监听所有的错误事件。</s></p><p>通过监听<code>playFailedAndPaused</code>事件，来统一处理业务。</p><div class="language-js"><pre><code><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> jessibuca <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    jessibuca <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JessibucaPro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 参数</span>
        <span class="token operator">...</span>options
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    jessibuca<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;playFailedAndPaused&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">reason<span class="token punctuation">,</span> lastFrameInfo<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>reason <span class="token operator">===</span> Jessibuca<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">.</span>fetchError <span class="token operator">||</span> reason <span class="token operator">===</span> Jessibuca<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">.</span>websocketError<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">resetPlayer</span><span class="token punctuation">(</span>lastFrameInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">// 延迟2s 触发播放</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    jessibuca<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">resetPlayer</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        jessibuca<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">create</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre></div><h2 id="关于播放器延迟-超过延迟触发丢帧-设置"><a class="header-anchor" href="#关于播放器延迟-超过延迟触发丢帧-设置" aria-hidden="true">#</a> 关于播放器延迟(超过延迟触发丢帧)设置</h2><p>目前播放器提供<code>videoBuffer</code>和<code>videoBufferDelay</code>两个参数来控制延迟。</p><p>对于<code>videoBuffer</code>参数（单位秒），是用来设置缓存的时长，啥意思呢？</p><blockquote><p>就是播放器在接收流数据之后，并没有立马解码播放，还是等待缓存了<code>videoBuffer</code>时长的数据之后才去按照一定的频率去解码-&gt;播放</p></blockquote><p>在播放过程中，会根据新来流的时间戳结合本地的时间戳，实时计算当前的延迟时长，当延迟小于<code>videoBufferDelay + videoBuffer</code> ,则不做任何处理，继续 解码-&gt;播放。</p><blockquote><p>当最新过来的流数据的时间戳，计算最新的延迟时长大于<code>videoBufferDelay + videoBuffer</code>的时候，就会触发，丢帧机制。</p></blockquote><h2 id="关于网络延迟"><a class="header-anchor" href="#关于网络延迟" aria-hidden="true">#</a> 关于网络延迟</h2><p>对于网络延迟，是如何计算而来的呢？</p><blockquote><p>当流过来的时候，本地也会同步的起一个时间线，因为是直播流，所以理论上如果没有网络延迟的情况下，1s的时间里面，流里面的数据也应该是1s的。</p></blockquote><p>所以根据这个依据，当本地过了<code>1s</code>之后，如果计算的流的数据只有<code>0.9s</code>的话，那这<code>1 - 0.9 = 0.1</code> 的就是网络延迟。</p><p>播放器支持配置<code>networkDelay</code>参数（单位秒s）,当播放器计算的网络延迟超过了预定设置的<code>networkDelay</code> 参数之后，当设置了<code>networkDelayTimeoutReplay</code>为true的时候，就会触发<code>networkDelayTimeout</code>事件。</p><p>业务可以通过监听</p><div class="language-js"><pre><code>jessbucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>JessibucaPro<span class="token punctuation">.</span><span class="token constant">EVENTS</span><span class="token punctuation">.</span>networkDelayTimeout<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ts</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ts 就是网络超时的时间，单位ms(毫秒)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="会出现本身延迟很低，但是网络延迟数据却很大"><a class="header-anchor" href="#会出现本身延迟很低，但是网络延迟数据却很大" aria-hidden="true">#</a> 会出现本身延迟很低，但是网络延迟数据却很大</h3><p>一般这种情况，会出现在机器是4g网络，然后机器向上推流的时候会存在丢帧的逻辑，但是时间戳的逻辑是不会变的，所以会出现这种情况。</p><p>比如机器的FPS是25,正常情况下，每秒会有25帧，然后每秒40ms的增加，这样一秒下来，25帧的时间戳就是1000ms。</p><p>但是如果存在丢帧的情况，比如丢帧了5帧，那么一秒就只会上传20帧的数据，但是还是每秒40ms的增加，这样一秒下来，20帧的时间戳就是800ms。这样就会少了200ms的数据。</p><p>然后结合播放器本地1s的时间，结合流里面的时间戳的时间，就会计算出200ms的网络延迟。</p><blockquote><p>基于这种情况，网络延迟的数据，只是一个参考值，不是绝对的。</p></blockquote><h2 id="配置低延迟（300ms）解决方案建议【直播流】"><a class="header-anchor" href="#配置低延迟（300ms）解决方案建议【直播流】" aria-hidden="true">#</a> 配置低延迟（300ms）解决方案建议【直播流】</h2><p>因为超低延迟，对于mse 和wcs并不能做到这么低的延迟方案，所以推荐使用wasm simd来实现。</p><p>推荐的配置方案：</p><div class="language-"><pre><code>{
    useMSE:false,
    useWCS:false,
    videoBuffer:0.1,
    videoBufferDelay:0.2,
    useSIMD: true,
}
</code></pre></div><p>如果需要更低的延迟，可以使用<code>videoBufferDelay</code>来配置延迟时间，单位是秒。</p><h2 id="崩溃日志上报"><a class="header-anchor" href="#崩溃日志上报" aria-hidden="true">#</a> 崩溃日志上报</h2><p>当播放器播放失败，或者崩溃重新播放的时候，会触发<code>crashLog</code>事件，可以监听这个事件，来上报崩溃日志。</p><p>可以监听<code>crashLog</code>事件</p><div class="language-js"><pre><code>jessibuca<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;crashLog&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>返回的数据有：</p><ul><li>url： 播放地址</li><li>error： 错误信息</li><li>playType ： 播放类型</li><li>demuxType：解封装类型</li><li>decodeType：解码类型</li><li>renderType: 渲染类型</li><li>videoInfo : 视频信息 {width,height,encType}</li><li>audioInfo : 音频信息 {encType,channels,sampleRate}</li><li>audioEngine ：音频引擎</li><li>allTimes ：播放时长，单位秒</li></ul><p>方便业务拿到数据进行数据上报。</p><h2 id="页面最小化（切换tab）超时检测建议"><a class="header-anchor" href="#页面最小化（切换tab）超时检测建议" aria-hidden="true">#</a> 页面最小化（切换tab）超时检测建议</h2><p>一般业务有需要监听页面最小化，或者切换tab的事件，来关闭播放器播放，并提示用户。</p><p>可以通过设置<code>pageVisibilityHiddenTimeout</code> 参数，单位<code>秒</code>，目前默认值是<code>5 * 60</code> 5分钟。</p><div class="language-js"><pre><code><span class="token comment">// 配置信息：</span>
<span class="token punctuation">{</span>
    <span class="token literal-property property">pageVisibilityHiddenTimeout</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过监听<code>visibilityHiddenTimeout</code>事件，来进行业务逻辑处理。</p><div class="language-js"><pre><code>player<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;visibilityHiddenTimeout&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 窗口不可见5分钟超时</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="播放地址首次就请求失败（非超时）"><a class="header-anchor" href="#播放地址首次就请求失败（非超时）" aria-hidden="true">#</a> 播放地址首次就请求失败（非超时）</h2><p><s>监听<code>jessibucaPro.EVENTS.error</code>事件</s></p><p><s>监听<code>JessibucaPro.ERROR.fetchError</code>和<code>JessibucaPro.ERROR.websocketError</code>事件</s></p><p>根据自己的业务播放的url地址类型，来监听对应的错误事件。</p><p>监听<code>playFailedAndPaused</code>事件</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>JessibucaPro<span class="token punctuation">.</span><span class="token constant">EVENTS</span><span class="token punctuation">.</span>playFailedAndPaused<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> frameInfo<span class="token punctuation">,</span> msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">===</span> JessibucaPro<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">.</span>fetchError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// http-flv 错误</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">===</span> JessibucaPro<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">.</span>websocketError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ws-flv 错误</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="页面首次加载超时检测"><a class="header-anchor" href="#页面首次加载超时检测" aria-hidden="true">#</a> 页面首次加载超时检测</h2><p>目前播放器的默认配置是</p><div class="language-"><pre><code>{
    loadingTimeout: 10,
    loadingTimeoutReplay:true,
    loadingTimeoutReplayTimes:3
}
</code></pre></div><blockquote><p>如果想要如果想无限次重试，可以设置loadingTimeoutReplayTimes为-1</p></blockquote><h2 id="页面播放过程中超时检测"><a class="header-anchor" href="#页面播放过程中超时检测" aria-hidden="true">#</a> 页面播放过程中超时检测</h2><p>目前播放器的默认配置是</p><div class="language-"><pre><code>{
    heartTimeout: 10,
    heartTimeoutReplay:true,
    heartTimeoutReplayTimes:3
}
</code></pre></div><blockquote><p>如果想要如果想无限次重试，可以设置heartTimeoutReplayTimes为-1</p></blockquote><h2 id="语音通讯集成"><a class="header-anchor" href="#语音通讯集成" aria-hidden="true">#</a> 语音通讯集成</h2><p>具体集成的demo 可以看 <code>talk-demo.html</code>文件</p><blockquote><p>需要单独引用<code>jessibuca-pro-talk.js</code>文件</p></blockquote><h2 id="单视频播放"><a class="header-anchor" href="#单视频播放" aria-hidden="true">#</a> 单视频播放</h2><blockquote><p>只需要将<code>hasAudio</code>设置为<code>false</code>即可, 播放器就不会解码音频流。</p></blockquote><h2 id="单音频播放"><a class="header-anchor" href="#单音频播放" aria-hidden="true">#</a> 单音频播放</h2><p>具体集成的demo 可以看 <code>only-audio-demo.html</code>文件</p><blockquote><p>只需要将<code>hasVideo</code>设置为<code>false</code>即可, 播放器就不会解码视频流。</p></blockquote><h2 id="纯音频播放器"><a class="header-anchor" href="#纯音频播放器" aria-hidden="true">#</a> 纯音频播放器</h2><p>纯音频播放器里面砍掉了和视频相关的逻辑，非常的轻量，并且可以支持移动端（IOS 和安卓）后台和息屏播放 。</p><p>页面需要引入<code>jessibuca-pro-audio-plauer.js</code>文件</p><p>具体集成demo 可以看 <code>audio-player-demo.html</code>文件</p><h2 id="配置自定义底部ui按钮"><a class="header-anchor" href="#配置自定义底部ui按钮" aria-hidden="true">#</a> 配置自定义底部UI按钮</h2><p>只需要配置<code>extendOperateBtns</code>参数即可</p><h2 id="配置右键菜单"><a class="header-anchor" href="#配置右键菜单" aria-hidden="true">#</a> 配置右键菜单</h2><p>只需要配置<code>contextmenuBtns</code>参数即可</p><h2 id="jessibuca-pro-js-decoder-pro-js-decoder-pro-simd-js-decoder-pro-wasm-decoder-pro-simd-wasm-文件想通过cdn加载"><a class="header-anchor" href="#jessibuca-pro-js-decoder-pro-js-decoder-pro-simd-js-decoder-pro-wasm-decoder-pro-simd-wasm-文件想通过cdn加载" aria-hidden="true">#</a> jessibuca-pro.js decoder-pro.js(decoder-pro-simd.js) decoder-pro.wasm(decoder-pro-simd.wasm)文件想通过CDN加载</h2><p>因为默认情况下 decoder-pro.js(decoder-pro-simd.js) 是通过相对路径引入 decoder-pro.wasm(decoder-pro-simd.wasm) 文件的。</p><p>如果想引用CDN的地址，需要修改成CDN的绝对地址。</p><p>所以如果想通过CDN加载，需要修改decoder-pro.js(decoder-pro-simd.js)文件</p><p>需要配置<code>decoder</code> 参数为CDN绝对地址文件。</p><blockquote><p>最新版本已经支持了通过配置 rollup.config.js 来实现修改<code>decoder-pro.js</code> 和 <code>decoder-pro-simd.js</code> 文件。</p></blockquote><blockquote><p><s>decoder-pro.js 和 decoder-pro-simd.js 文件都需要修改。</s></p></blockquote><blockquote><p>jessibuca-pro.js decoder-pro.js(decoder-pro-simd.js) decoder-pro.wasm(decoder-pro-simd.wasm) 需要放在同一个目录下。</p></blockquote><div class="language-js"><pre><code><span class="token keyword">const</span> jessibucaPro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JessibucaPro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">decoder</span><span class="token operator">:</span> <span class="token string">&#39;https://your-cdn.com/decoder-pro.js&#39;</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>(废弃掉了)</p><div class="language-js"><pre><code>
<span class="token comment">// (废弃掉了)</span>
<span class="token comment">// 修改前 src/worker/index.js</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>decoderWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>_opt<span class="token punctuation">.</span>decoder<span class="token punctuation">)</span>

<span class="token comment">// 修改后 src/worker/index.js</span>
<span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">importScripts(&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>player<span class="token punctuation">.</span>_opt<span class="token punctuation">.</span>decoder<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&#39;application/javascript&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> blobUrl <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>decoderWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>blobUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>(废弃掉了)</p><div class="language-js"><pre><code><span class="token comment">// (废弃掉了)</span>
<span class="token comment">// 修改前 src/decoder/decoder-pro.js</span>
wasmBinaryFile <span class="token operator">=</span> <span class="token string">&#39;decoder-pro.wasm&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 修改后 src/decoder/decoder.js</span>
wasmBinaryFile <span class="token operator">=</span> <span class="token string">&#39;https://cdn.com/decoder-pro.wasm&#39;</span><span class="token punctuation">;</span>
</code></pre></div><p>(废弃掉了)</p><div class="language-js"><pre><code><span class="token comment">// (废弃掉了)</span>

<span class="token comment">// 修改前 src/decoder/decoder-pro-simd.js</span>
wasmBinaryFile <span class="token operator">=</span> <span class="token string">&#39;decoder-pro-simd.wasm&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 修改后 src/decoder/decoder-pro-simd.js</span>
wasmBinaryFile <span class="token operator">=</span> <span class="token string">&#39;https://cdn.com/decoder-pro-simd.wasm&#39;</span><span class="token punctuation">;</span>
</code></pre></div><p>然后需要重新执行下 <code>npm run build</code> 命令 就可以了。</p><h3 id="最新版本"><a class="header-anchor" href="#最新版本" aria-hidden="true">#</a> 最新版本</h3><p>不需要执行<code>decoder-pro.js</code> 和 <code>decoder-pro-simd.js</code> 和<code>decoder-pro-hard.jd</code>文件的修改。</p><p>只需要配置</p><div class="language-js"><pre><code><span class="token keyword">const</span> jessibucaPro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JessibucaPro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">decoder</span><span class="token operator">:</span> <span class="token string">&#39;https://your-cdn.com/decoder-pro.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isDecoderUseCDN</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>然后在 <code>rollup.config.js</code> 里面</p><div class="language-js"><pre><code><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">&#39;node_modules/**&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">__ENV__</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">__VERSION__</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">__BUILD_DAY__</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>buildDay<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">__TIMEOUT__</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// JESSIBUCA_PRO_WASM_URL:JSON.stringify(&#39;http://jessibuca.monibuca.com/pro/decoder-pro.wasm&#39;),</span>
    <span class="token comment">// JESSIBUCA_PRO_SIMD_WASM_URL:JSON.stringify(&#39;http://jessibuca.monibuca.com/pro/decoder-pro-simd.wasm&#39;),</span>
    <span class="token comment">// JESSIBUCA_PRO_AUDIO_WASM_URL:JSON.stringify(&#39;http://jessibuca.monibuca.com/pro/decoder-pro-audio.wasm&#39;),</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>只需要把<code>JESSIBUCA_PRO_WASM_URL</code> 和<code>JESSIBUCA_PRO_SIMD_WASM_URL</code>， <code>JESSIBUCA_PRO_AUDIO_WASM_URL</code> 放开。并修改为贵公司的CDN地址即可。</p><p>然后执行<code>npm run build</code> 命令 就可以了。</p><h2 id="限制js的使用域名和限制播放url的域名"><a class="header-anchor" href="#限制js的使用域名和限制播放url的域名" aria-hidden="true">#</a> 限制js的使用域名和限制播放url的域名</h2><p>可以看下<code>utils</code>文件夹下面的<code>verify.js</code>文件。</p><p>对于host的生成，可以看下<code>utils</code>文件夹下面的<code>string2CharCodeHex.js</code>文件。</p><p>然后可以通过在 <code>jessibuca.js</code>的 <code>play()</code> 方法里面添加判断逻辑。</p><div class="language-js"><pre><code><span class="token comment">//</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">veriify</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;url is not valid&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="关于自定义按钮和系统默认提供的按钮"><a class="header-anchor" href="#关于自定义按钮和系统默认提供的按钮" aria-hidden="true">#</a> 关于自定义按钮和系统默认提供的按钮</h2><p>一般现在的问题：</p><ol><li>系统自带的按钮顺序和icon不满足业务系统</li><li>系统自带的按钮的功能不满足业务系统</li><li>希望使用自带的按钮样式和功能（排序也有要求）</li></ol><h3 id="解决方案："><a class="header-anchor" href="#解决方案：" aria-hidden="true">#</a> 解决方案：</h3><p>如果是按钮的功能不满足业务需求，可以通过配置<code>playFn</code>,<code>pauseFn</code> 等方法来配置自定义的方法、</p><p>如果不想要系统提供的按钮，可以通过配置<code>extendOperateBtns</code> 参数来配置、支持设置<code>index</code>，<code>icon</code> ，<code>active icon </code>, <code>click</code> , <code>active click</code> 等参数</p><h2 id="关于性能面板"><a class="header-anchor" href="#关于性能面板" aria-hidden="true">#</a> 关于性能面板</h2><p>在调试过程中，性能面板是一个非常重要的一个东西，上面显示的是流的实时的数据。</p><p>可以通过配置</p><div class="language-"><pre><code>{
    showPerformance:true, // 直接显示性能面板数据
    operateBtns:{
        performance:true // 底部控制条按钮
    }
}
</code></pre></div><h2 id="关于日志输出"><a class="header-anchor" href="#关于日志输出" aria-hidden="true">#</a> 关于日志输出</h2><p>关于日志，是主要是控制台输出的内容，可以通过配置<code>debug:true</code> 来打开日志输出。</p><blockquote><p>不管是否配置了<code>debug:true</code>，error的日志默认是强制直接输出的。</p></blockquote><p>默认显示的日志级别是<code>warn</code>,可以通过配置<code>debugLevel:&#39;debug&#39;</code> 讲日志级别调成全量模式。</p><blockquote><p>如果是多屏的输出，可以通过配置<code>isMulti:true</code> 来配置播放多实例模式。这个模式下，日志输出会有[uuid] 来区分各个实例日志。</p></blockquote><h2 id="播放的时候解除静音"><a class="header-anchor" href="#播放的时候解除静音" aria-hidden="true">#</a> 播放的时候解除静音</h2><p>播放器默认播放的时候，是静音播放的。所以如果想播放的时候解除静音，则需要配置<code>isNotMute:true</code>就可以了。</p><blockquote><p>如果是程序触发的自动播放播放器，是不会有声音的，需要用户手动触发才会有声音。</p></blockquote><h3 id="苹果手机默认没有声音。"><a class="header-anchor" href="#苹果手机默认没有声音。" aria-hidden="true">#</a> 苹果手机默认没有声音。</h3><p>在设置<code>isNotMute:true</code> 在苹果的手机端默认是没有声音的。</p><blockquote><p>iPhone，chrome等要求自动播放时，音频必须静音，需要由一个真实的用户交互操作来恢复，不能使用代码。</p></blockquote><p>程序里面可以检查下播放器的状态，如果是静音状态，就需要需要出一个ui交互，让用户手动恢复声音播放。</p><div class="language-js"><pre><code><span class="token keyword">var</span> result <span class="token operator">=</span> jessibucaPro<span class="token punctuation">.</span><span class="token function">isMute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 这里可以出一个ui交互，让用户手动恢复声音播放</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以结合<code>audioResume()</code>方法。</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">audioResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="关于水印"><a class="header-anchor" href="#关于水印" aria-hidden="true">#</a> 关于水印</h2><h3 id="全屏水印"><a class="header-anchor" href="#全屏水印" aria-hidden="true">#</a> 全屏水印</h3><p>全屏水印指的是：<code>播放器整个播放窗口重复显示水印</code>。</p><p>可以通过参数<code>fullscreenWatermarkConfig</code> 来实现全屏水印，仅支持文字</p><h3 id="局部水印"><a class="header-anchor" href="#局部水印" aria-hidden="true">#</a> 局部水印</h3><p>支持：<code>图片</code> 和 <code>文字</code>和 <code>自定义HTML</code></p><p>可以通过配置<code>watermarkConfig</code> 来实现局部水印。</p><h3 id="动态水印"><a class="header-anchor" href="#动态水印" aria-hidden="true">#</a> 动态水印</h3><p>支持<code>文字</code></p><p>通过配置<code>dynamicWatermarkConfig</code> 来实现动态水印</p><h3 id="幽灵水印"><a class="header-anchor" href="#幽灵水印" aria-hidden="true">#</a> 幽灵水印</h3><p>支持<code>文字</code></p><p>通过配置<code>ghostWatermarkConfig</code> 来实现动态水印</p><h2 id="使用那种标签渲染"><a class="header-anchor" href="#使用那种标签渲染" aria-hidden="true">#</a> 使用那种标签渲染</h2><p>目前播放器支持<code>video</code> 和<code>canvas</code>两种标签渲染</p><p>可以通过参数 <code>useVideoRender</code> 和 <code>useCanvasRender</code> 来配置</p><blockquote><p>当两者同时设置为true的时候，video的标签渲染优先级大于canvas。</p></blockquote><h2 id="关于视频录制"><a class="header-anchor" href="#关于视频录制" aria-hidden="true">#</a> 关于视频录制</h2><p>目前播放器支持录制 <code>mp4</code> 和 <code>webm</code> 、<code>flv</code> 格式的视频</p><blockquote><p>mp4 只支持录制视频</p></blockquote><blockquote><p>webm 格式支持录制视频和音频（音频需要在打开声音的状态才能被录制进去）</p></blockquote><blockquote><p>flv 格式支持录制视频和音频（静音状态下也能录制音频）</p></blockquote><blockquote><p>mp4 wasm 录制支持音频+视频</p></blockquote><h3 id="关于录制mp4文件，并且要支持音频-视频"><a class="header-anchor" href="#关于录制mp4文件，并且要支持音频-视频" aria-hidden="true">#</a> 关于录制mp4文件，并且要支持音频+视频</h3><p>可以用<code>扩展模块</code> wasm mp4录制模块来实现</p><p>视频支持的编码格式：h264、h265、</p><p>音频支持的编码格式：aac、mp3、</p><blockquote><p>添加微信：bosswancheng 咨询</p></blockquote><h2 id="关于出现绿屏或者花屏的时候"><a class="header-anchor" href="#关于出现绿屏或者花屏的时候" aria-hidden="true">#</a> 关于出现绿屏或者花屏的时候</h2><p>如果流数据的首帧不是I帧，一般情况下，解码了之后，就会很容易出现<code>绿屏</code>或者<code>花屏</code>情况。</p><p>播放器支持配置检查首帧是否是I帧，如果不是I帧就直接过滤掉，直到等到I帧出现才开始解码流数据</p><p>只需要配置<code>checkFirstIFrame:true</code></p><blockquote><p>默认播放器就是设置为true的，不建议修改为false</p></blockquote><p>如果本身流就是特殊的流，能够保证解码出来的画面不是花屏的，就可以设置为false</p><h2 id="关于音频引擎"><a class="header-anchor" href="#关于音频引擎" aria-hidden="true">#</a> 关于音频引擎</h2><p>目前播放器支持三种音频引擎来播放音频数据，<code>worklet</code>、<code>script</code>、<code>active</code></p><p>目前播放器会根据当前用户的实际情况来动态选择最适合的播放引擎。</p><blockquote><p>会优先判断是否在<code>微信安卓</code>环境</p></blockquote><h3 id="worklet"><a class="header-anchor" href="#worklet" aria-hidden="true">#</a> worklet</h3><p>必须是https 环境下，配置才会生效。</p><blockquote><p>默认https环境下，默认就是这个播放引擎。</p></blockquote><h3 id="script"><a class="header-anchor" href="#script" aria-hidden="true">#</a> script</h3><p>兼容性最高的播放引擎。</p><blockquote><p>一般情况下都是这种引擎。</p></blockquote><h3 id="active"><a class="header-anchor" href="#active" aria-hidden="true">#</a> active</h3><p>为了支持在<code>安卓的微信</code>环境播放，特殊实现的一种播放引擎。</p><blockquote><p>其他环境不建议使用这个引擎。</p></blockquote><h2 id="ptz-操作"><a class="header-anchor" href="#ptz-操作" aria-hidden="true">#</a> ptz 操作</h2><p>ptz是执行国标gb28181的ptz操作，目前支持的操作有：<code>上下左右</code>，<code>左上</code>，<code>右上</code>，<code>左下</code>，<code>右下</code>，<code>缩放+-</code>，<code>光圈+-</code>，<code>聚焦+-</code>。</p><p>步骤：</p><ol><li>点击播放器上面的ptz按钮。</li><li>通过监听事件<code>ptz</code>来获取到对应的事件。</li><li>通过调用服务器端的接口来实现ptz操作。</li></ol><p>支持的配置参数：</p><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">JessibucaPro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 其他参数</span>
    <span class="token literal-property property">ptzClickType</span><span class="token operator">:</span> <span class="token string">&#39;click | mouseDownAndUp&#39;</span><span class="token punctuation">,</span> <span class="token comment">// ptz操作的交互方式</span>
    <span class="token literal-property property">ptzStopEmitDelay</span><span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// ptz操作停止后，延迟多久触发停止事件</span>
    <span class="token literal-property property">ptzZoomShow</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否显示ptz的缩放按钮</span>
    <span class="token literal-property property">ptzApertureShow</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否显示ptz的光圈按钮</span>
    <span class="token literal-property property">ptzFocusShow</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否显示ptz的聚焦按钮</span>
    <span class="token literal-property property">ptzMoreArrowShow</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否显示ptz的更多按钮(左上，右上，左下，右下)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>支持的事件：</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>JessibucaPro<span class="token punctuation">.</span><span class="token constant">EVENTS</span><span class="token punctuation">.</span>ptz<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ptzStart&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>目前ptz操作支持两种交互方式<code>click</code> 和<code>mouseDownAndUp</code>， 可以通过配置<code>ptzClickType: click | mouseDownAndUp</code> 参数。</p><h3 id="click"><a class="header-anchor" href="#click" aria-hidden="true">#</a> click</h3><p>鼠标点击事件</p><p>可以通过配置<code>ptzStopEmitDelay</code>参数来配置ptz操作停止后，延迟多久触发<code>stop</code>停止事件。</p><h3 id="mousedownandup"><a class="header-anchor" href="#mousedownandup" aria-hidden="true">#</a> mouseDownAndUp</h3><p>鼠标按下，和松开 分别触发事件。</p><h3 id="配置额外的按钮（更多方向、镜头、聚焦、光圈）"><a class="header-anchor" href="#配置额外的按钮（更多方向、镜头、聚焦、光圈）" aria-hidden="true">#</a> 配置额外的按钮（更多方向、镜头、聚焦、光圈）</h3><p>可以通过配置参数<code>ptzMoreArrowShow</code>， <code>ptzZoomShow</code>,<code>ptzApertureShow</code>,<code>ptzFocusShow</code> 来配置是否显示额外的按钮。</p><h2 id="加密流播放"><a class="header-anchor" href="#加密流播放" aria-hidden="true">#</a> 加密流播放</h2><blockquote><p>目前加密流只对接了m7s 的服务器</p></blockquote><p>如果想要播放加密流，需要配置<code>isM7sCrypto:true</code> 还有<code>cryptoKeyUrl: your_href</code>参数。</p><blockquote><p>cryptoKeyUrl 是获取秘钥的接口地址。</p></blockquote><h2 id="关于集成语音通讯"><a class="header-anchor" href="#关于集成语音通讯" aria-hidden="true">#</a> 关于集成语音通讯</h2><h3 id="整体逻辑"><a class="header-anchor" href="#整体逻辑" aria-hidden="true">#</a> 整体逻辑</h3><ol><li>浏览器端采集麦克风数据</li><li>将麦克风数据(rtp包)发送给服务端</li><li>服务器端将麦克风数据(rtp包)转发给摄像头</li><li>摄像头播放声音</li></ol><p>目前支持<code>单独</code>或者<code>集成</code>在播放器中使用语音通讯</p><blockquote><p><code>单独</code> 使用需要单独引用<code>jessibuca-pro-talk.js</code>文件</p></blockquote><p>目前语音通讯支持采集<code>pcm</code>、<code>g711a</code>、<code>g711u</code>、格式的数据，支持封装成<code>rtp</code>包格式。</p><p>并支持<code>checkGetUserMediaTimeout</code> 和 <code>getUserMediaTimeout</code> 参数用来检测获取<code>getUserMedia</code> 超时</p><h2 id="需要监听websocket的事件和调用send-方法"><a class="header-anchor" href="#需要监听websocket的事件和调用send-方法" aria-hidden="true">#</a> 需要监听websocket的事件和调用send 方法</h2><p>会存在私有的websocket请求，需要授权才能播放，就需要监听<code>websocket</code>的<code>open</code>事件和调用<code>send</code> 方法。</p><p>为此，播放器提供了<code>websocketOpen</code> 事件和 <code>sendWebsocketMessage</code> 方法。</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>JessibucaPro<span class="token punctuation">.</span><span class="token constant">EVENTS</span><span class="token punctuation">.</span>websocketOpen<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;websocket open&#39;</span><span class="token punctuation">)</span>
    <span class="token comment">// 在这里可以做授权的逻辑</span>
    jessibucaPro<span class="token punctuation">.</span><span class="token function">sendWebsocketMessage</span><span class="token punctuation">(</span><span class="token string">&#39;授权的消息&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="手机端全屏"><a class="header-anchor" href="#手机端全屏" aria-hidden="true">#</a> 手机端全屏</h2><p>播放器默认是调用的系统层面的全屏事件。</p><p>会存在客户需要手机端全屏，但是不想调用系统层面的全屏事件的情况。可以通过配置<code>useWebFullScreen</code> 来实现。</p><p>同样的需要监听<code>webFullscreen</code> 来监听全屏事件。</p><h2 id="多屏播放"><a class="header-anchor" href="#多屏播放" aria-hidden="true">#</a> 多屏播放</h2><p>可以使用<code>jessibuca-pro-multi.js</code> 来实现多屏播放。</p><blockquote><p>具体demo 看 <code>multi-demo.html</code> 文件</p></blockquote><blockquote><p>如果引用了<code>jessibuca-pro-multi.js</code>，那么<code>jessibuca-pro.js</code>就不需要引用了。</p></blockquote><h2 id="gzip-压缩资源文件"><a class="header-anchor" href="#gzip-压缩资源文件" aria-hidden="true">#</a> gzip 压缩资源文件</h2><blockquote><p>可以通过gzip压缩资源文件，来减少资源文件的大小。</p></blockquote><h4 id="mac-linux"><a class="header-anchor" href="#mac-linux" aria-hidden="true">#</a> mac(linux)</h4><p>安装gzip</p><p><a href="https://formulae.brew.sh/formula/gzip" target="_blank" rel="noopener noreferrer">https://formulae.brew.sh/formula/gzip</a></p><h4 id="jessibuca-pro-js"><a class="header-anchor" href="#jessibuca-pro-js" aria-hidden="true">#</a> jessibuca-pro.js</h4><div class="language-"><pre><code>gzip jessibuca-pro.js
mv jessibuca-pro.js.gz jessibuca-pro.js
</code></pre></div><h4 id="decoder-pro-js"><a class="header-anchor" href="#decoder-pro-js" aria-hidden="true">#</a> decoder-pro.js</h4><div class="language-"><pre><code>gzip 和decoder-pro.js
mv 和decoder-pro.js.gz 和decoder-pro.js
</code></pre></div><h4 id="decoder-pro-wasm"><a class="header-anchor" href="#decoder-pro-wasm" aria-hidden="true">#</a> decoder-pro.wasm</h4><div class="language-"><pre><code>gzip 和decoder-pro.wasm
mv 和decoder-pro.wasm.gz 和decoder-pro.wasm
</code></pre></div><h4 id="decoder-pro-simd-js"><a class="header-anchor" href="#decoder-pro-simd-js" aria-hidden="true">#</a> decoder-pro-simd.js</h4><div class="language-"><pre><code>gzip 和decoder-pro-simd.js
mv 和decoder-pro-simd.js.gz 和decoder-pro-simd.js
</code></pre></div><h4 id="decoder-pro-simd-wasm"><a class="header-anchor" href="#decoder-pro-simd-wasm" aria-hidden="true">#</a> decoder-pro-simd.wasm</h4><div class="language-"><pre><code>gzip 和decoder-pro-simd.wasm
mv 和decoder-pro-simd.wasm.gz 和decoder-pro-simd.wasm
</code></pre></div><h4 id="windows"><a class="header-anchor" href="#windows" aria-hidden="true">#</a> windows</h4><p>安装gzip</p><p><a href="http://gnuwin32.sourceforge.net/downlinks/gzip-bin-zip.php" target="_blank" rel="noopener noreferrer">http://gnuwin32.sourceforge.net/downlinks/gzip-bin-zip.php</a></p><p>解压后，将 <code>jessibuca-pro.js</code> 和 <code>decoder-pro.js</code>和 <code>decoder-pro.wasm</code> 和 <code>decoder-pro-simd.js</code>和 <code>decoder-pro-simd.wasm</code> 文件拖到 gzip.exe上，文件就压缩好了，也需要去掉.gz后缀</p><h4 id="配置http头"><a class="header-anchor" href="#配置http头" aria-hidden="true">#</a> 配置HTTP头</h4><p>对于js文件 需要配置<code>Content-Encoding: gzip</code>，<code>Content-Type: text/javascript</code></p><p>对于wasm文件，需要配置<code>Content-Encoding: gzip</code>，<code>Content-Type: application/wasm</code></p><h2 id="如何配置底部自定义按钮（事件）"><a class="header-anchor" href="#如何配置底部自定义按钮（事件）" aria-hidden="true">#</a> 如何配置底部自定义按钮（事件）</h2><h3 id="自定义按钮"><a class="header-anchor" href="#自定义按钮" aria-hidden="true">#</a> 自定义按钮</h3><h3 id="自定义事件"><a class="header-anchor" href="#自定义事件" aria-hidden="true">#</a> 自定义事件</h3><h2 id="异步加载js文件"><a class="header-anchor" href="#异步加载js文件" aria-hidden="true">#</a> 异步加载js文件</h2><p>有客户不想通过script标签来加载js文件，而是想通过异步加载js文件的方式来加载。</p><p>可以通过<code>loadJs</code>方法来实现。</p><p>具体demo见：<code>async-demo.html</code></p><h2 id="如果业务层需要自己处理播放异常逻辑。"><a class="header-anchor" href="#如果业务层需要自己处理播放异常逻辑。" aria-hidden="true">#</a> 如果业务层需要自己处理播放异常逻辑。</h2><blockquote><p>会存在客户的流，在一次播放之后，就没法再使用了。所以需要在播放异常的时候，重新请求流的地址。</p></blockquote><p>需要客户把一些参数都关闭掉，不能触发播放器自己内部的重播。</p><div class="language-"><pre><code>// 废弃了----------------
{
    autoWasm: false,
    webglAlignmentErrorReplay:false,
    webglContextLostErrorReplay:false,
    mseDecodeErrorReplay: false,
    mediaSourceTsIsMaxDiffReplay:false,
    wasmDecodeErrorReplay:false,
    wcsDecodeErrorReplay: false,
    networkDelayTimeoutReplay:false,
    heartTimeoutReplay:false,
    loadingTimeoutReplay:false,
    simdDecodeErrorReplay:false
    videoElementPlayingFailedReplay:false
}
// 废弃了----------------
</code></pre></div><div class="language-"><pre><code>// 推荐使用
{
   playFailedAndReplay:false
}

</code></pre></div><blockquote><p>播放器内部会统一的把原子化的replay 参数设置为 false。</p></blockquote><p>可以通过监听<code>playFailedAndPaused</code>事件来监听。</p><p>然后后续操作：</p><ol><li>销毁播放器</li><li>重新建立播放器</li><li>调用play()方法</li></ol><p>支持重播的时候</p><div class="language-js"><pre><code><span class="token keyword">var</span> jessibucaPro <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
<span class="token keyword">function</span> <span class="token function">createPlayer</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span>isReplay <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    jessibucaPro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JessibucaPro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 其他参数</span>
        <span class="token operator">...</span>options<span class="token punctuation">,</span>
        <span class="token comment">// 重播的时候，不显示loadingicon</span>
        <span class="token literal-property property">loadingIcon</span><span class="token operator">:</span>isReplay <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 异常导致内部重播的时候显示最后一帧。</span>
        <span class="token literal-property property">replayUseLastFrameShow</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 异常导致内部重播的时候不显示loadingicon</span>
        <span class="token literal-property property">replayShowLoadingIcon</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 监听事件</span>
    jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;playFailedAndPaused&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span>frameInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 重播的时候，不希望出现黑屏，就将 frameInfo 传入。</span>
        <span class="token function">resetPlayer</span><span class="token punctuation">(</span>frameInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// 延迟2秒之后，重新播放</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                jessibucaPro<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;播放地址&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 重置播放器</span>
<span class="token keyword">function</span> <span class="token function">resetPlayer</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        jessibucaPro<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            jessibucaPro <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token function">createPlayer</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建播放器、</span>
<span class="token function">createPlayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="多屏需求"><a class="header-anchor" href="#多屏需求" aria-hidden="true">#</a> 多屏需求</h2><h3 id="如果不需要播放音频"><a class="header-anchor" href="#如果不需要播放音频" aria-hidden="true">#</a> 如果不需要播放音频</h3><p>可以设置<code>hasAudio</code>为<code>false</code>，这样就不会解码音频数据了，可以提升性能。</p><h3 id="只需要硬解码的话"><a class="header-anchor" href="#只需要硬解码的话" aria-hidden="true">#</a> 只需要硬解码的话</h3><p>可以通过设置</p><div class="language-"><pre><code> mseDecodeErrorReplay:true, // 默认是true
 wcsDecodeErrorReplay:true, // 默认是true
 // autoWasm:false // 废弃了，不需要配置
 decoderErrorAutoWasm:false,
</code></pre></div><p>这样mse(wcs) 解码报错的时候，不降级到wasm解码（仍然使用mse或者wcs解码）。</p><blockquote><p>确保当前环境支持mse(wcs)，H264、H265解码。不然就直接播放失败了。</p></blockquote><h2 id="理解-loadingtimeout-和-delaytimeout-和loadingtimeoutretryend-和-delaytimeoutretryend事件"><a class="header-anchor" href="#理解-loadingtimeout-和-delaytimeout-和loadingtimeoutretryend-和-delaytimeoutretryend事件" aria-hidden="true">#</a> 理解 loadingTimeout 和 delayTimeout 和loadingTimeoutRetryEnd 和 delayTimeoutRetryEnd事件</h2><ol><li><p><code>loadingTimeout</code> 和 <code>delayTimeout</code> 事件 每次都会触发</p></li><li><p>在配置了<code>heartTimeoutReplay</code> 或者<code>loadingTimeoutReplay</code>的情况下，播放器内部 会自动重播。</p></li><li><p>当重播次数达到了<code>loadingTimeoutReplayTimes</code> 或者 <code>heartTimeoutReplayTimes</code>的时候，会触发<code>loadingTimeoutRetryEnd</code> 或者 <code>delayTimeoutRetryEnd</code>事件。</p></li></ol><blockquote><p>所以如果业务逻辑需要在检测到重连次数结束之后，需要做一些事情，可以监听<code>loadingTimeoutRetryEnd</code> 或者 <code>delayTimeoutRetryEnd</code>这两个事件。</p></blockquote><h2 id="_7-24小时播放需求（支持断网重连）"><a class="header-anchor" href="#_7-24小时播放需求（支持断网重连）" aria-hidden="true">#</a> 7*24小时播放需求（支持断网重连）</h2><p>如果客户需要支持视频在任何情况下都要播放。</p><p>设置重播次数为无数次</p><div class="language-"><pre><code>heartTimeoutReplayTimes:-1,
loadingTimeoutReplayTimes:-1,
</code></pre></div><p>捕获<code>play()</code>的<code>catch</code>事件</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//  重试</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 重播</span>
       <span class="token function">replay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>监听播放器的<code>playFailedAndPaused</code>事件</p><div class="language-js"><pre><code><span class="token keyword">var</span> jessibucaPro <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
<span class="token keyword">function</span> <span class="token function">createPlayer</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span>isReplay <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    jessibucaPro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JessibucaPro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 其他参数</span>
        <span class="token operator">...</span>options<span class="token punctuation">,</span>
        <span class="token comment">// 重播的时候，不显示loadingicon</span>
        <span class="token literal-property property">loadingIcon</span><span class="token operator">:</span>isReplay <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 异常导致内部重播的时候显示最后一帧。</span>
        <span class="token literal-property property">replayUseLastFrameShow</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 异常导致内部重播的时候不显示loadingicon</span>
        <span class="token literal-property property">replayShowLoadingIcon</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 监听事件</span>
    jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;playFailedAndPaused&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span>frameInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 重播的时候，不希望出现黑屏，就将 frameInfo 传入。</span>
        <span class="token function">resetPlayer</span><span class="token punctuation">(</span>frameInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// 延迟2秒之后，重新播放</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                jessibucaPro<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;播放地址&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 重置播放器</span>
<span class="token keyword">function</span> <span class="token function">resetPlayer</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        jessibucaPro<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            jessibucaPro <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token function">createPlayer</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建播放器、</span>
<span class="token function">createPlayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="如果需要重播-内部-或网络断开手动触发重播的时候画面停留在失败前最后一帧-支持配置是否显示loading画面"><a class="header-anchor" href="#如果需要重播-内部-或网络断开手动触发重播的时候画面停留在失败前最后一帧-支持配置是否显示loading画面" aria-hidden="true">#</a> 如果需要重播(内部)或网络断开手动触发重播的时候画面停留在失败前最后一帧(支持配置是否显示loading画面)</h2><p>目前播放器内部会触发重播，还有通过监听<code>playFailedAndPaused</code>事件的重播。如果想要这两种重播的时候，显示最后一帧画面，并且想要不出现loading的icon。</p><p>首先：</p><div class="language-"><pre><code>replayUseLastFrameShow:true
</code></pre></div><blockquote><p>目前默认是true的。不需要额外再设置了。</p></blockquote><p>如果希望重播的时候，不出现loading画面，需要再配置下</p><div class="language-"><pre><code>replayShowLoadingIcon:false
</code></pre></div><p>如果触发了http 网络断开，或者websocke网络断开的业务场景。</p><p>在手动触发重播的时候，不希望出现黑屏。</p><div class="language-js"><pre><code><span class="token keyword">var</span> jessibucaPro <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
<span class="token keyword">function</span> <span class="token function">createPlayer</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span>isReplay <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    jessibucaPro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JessibucaPro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 其他参数</span>
        <span class="token operator">...</span>options<span class="token punctuation">,</span>
        <span class="token comment">// 重播的时候，不显示loadingicon</span>
        <span class="token literal-property property">loadingIcon</span><span class="token operator">:</span>isReplay <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 异常导致内部重播的时候显示最后一帧。</span>
        <span class="token literal-property property">replayUseLastFrameShow</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 异常导致内部重播的时候不显示loadingicon</span>
        <span class="token literal-property property">replayShowLoadingIcon</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 监听事件</span>
    jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;playFailedAndPaused&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span>frameInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 重播的时候，不希望出现黑屏，就将 frameInfo 传入。</span>
        <span class="token function">resetPlayer</span><span class="token punctuation">(</span>frameInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// 延迟2秒之后，重新播放</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                jessibucaPro<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;播放地址&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 重置播放器</span>
<span class="token keyword">function</span> <span class="token function">resetPlayer</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        jessibucaPro<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            jessibucaPro <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token function">createPlayer</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建播放器、</span>
<span class="token function">createPlayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><blockquote><p>某些情况下，因为重置播放器的时候，是一个异步的过程，所以可能会出现画面闪烁下的情况。</p></blockquote><h2 id="如果是多屏需求（硬解码）"><a class="header-anchor" href="#如果是多屏需求（硬解码）" aria-hidden="true">#</a> 如果是多屏需求（硬解码）</h2><p>异常之后仍然使用硬解码</p><div class="language-"><pre><code>mseDecodeErrorReplay:true, // 默认是true
wcsDecodeErrorReplay:true, // 默认是true
// autoWasm:false // 废弃了，不需要配置
decoderErrorAutoWasm:false,
</code></pre></div><h2 id="结合sei数据-currentpts事件-addcontenttocanvas-方法-实现给视频添加人脸或者物品打框子。"><a class="header-anchor" href="#结合sei数据-currentpts事件-addcontenttocanvas-方法-实现给视频添加人脸或者物品打框子。" aria-hidden="true">#</a> 结合SEI数据+ currentPts事件+ addContentToCanvas()方法 实现给视频添加人脸或者物品打框子。</h2><p>打框子的数据是通过流里面的SEI数据来获取到的，业务可以通过监听<code>videoSEI</code>事件来获取到SEI数据,然后缓存在数组里面。</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;videoSEI&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">videoSEI ts is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>ts<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, data is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个 TextDecoder 对象</span>
    <span class="token keyword">const</span> str <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解析出来sei的数据。</span>
   <span class="token comment">// 可以利用数组接收</span>
    seiList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>// 通过监听currentPts事件</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;currentPts&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">ts</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//  找到指定帧的sei数据</span>
    <span class="token keyword">const</span> seiItem <span class="token operator">=</span> seiList<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> diff <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>ts <span class="token operator">-</span> ts<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 硬解码解码的pts数据可能会</span>
        <span class="token keyword">return</span> diff <span class="token operator">&lt;=</span> <span class="token number">17</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 可以将时间戳小于/等于ts的扔掉了。</span>
    seiList <span class="token operator">=</span> seiList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span>ts <span class="token operator">&gt;</span> ts<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>seiItem<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 通过addContentToCanvas()方法来实现给视频添加人脸或者物品打框子。</span>
        jessibucaPro<span class="token punctuation">.</span><span class="token function">addContentToCanvas</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">//</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="实时监听视频是否卡顿"><a class="header-anchor" href="#实时监听视频是否卡顿" aria-hidden="true">#</a> 实时监听视频是否卡顿</h2><p>通过监听<code>videoSmooth</code>事件来实现。</p><div class="language-js"><pre><code>
jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>JessibucaPro<span class="token punctuation">.</span><span class="token constant">EVENTS</span><span class="token punctuation">.</span>videoSmooth<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">videoSmooth<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;is video smooth&quot;</span><span class="token punctuation">,</span> videoSmooth<span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>第二个参数就是啥原因导致的卡顿。</p><h2 id="视频录制是否可以支持水印（图片，或者文字）"><a class="header-anchor" href="#视频录制是否可以支持水印（图片，或者文字）" aria-hidden="true">#</a> 视频录制是否可以支持水印（图片，或者文字）</h2><p>不支持录制有水印的视频。</p><blockquote><p>因为如果视频需要增加水印的话，需要每一帧重新编码（裸流+水印），经历 <code>解码+加水印+然后编码</code> 过程。而且非常吃性能，不推荐在客户端做这个。</p></blockquote><h2 id="配置分辨率，支持切换分辨率的时候切换播放地址。"><a class="header-anchor" href="#配置分辨率，支持切换分辨率的时候切换播放地址。" aria-hidden="true">#</a> 配置分辨率，支持切换分辨率的时候切换播放地址。</h2><p>例如目前需求有 <code>720P——1280*720——HD（高清）</code> 和 <code>1080P——1920*1080——FHD（全高清）</code> 两种分辨率。</p><p>在初始化播放的时候配置</p><div class="language-js"><pre><code><span class="token keyword">const</span> jessibuca <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JessibucaPro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 其他参数</span>
    <span class="token literal-property property">qualityConfig</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;高清&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;全高清&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>然后用户在切换UI上面的分辨率的时候，通过监听事件<code>streamQualityChange</code>，</p><div class="language-js"><pre><code>jessibuca<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>JessibucaPro<span class="token punctuation">.</span><span class="token constant">EVENTS</span><span class="token punctuation">.</span>streamQualityChange<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">&#39;高清&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        jessibuca<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;高清的播放地址&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">&#39;全高清&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        jessibuca<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;全高清的播放地址&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><!----></div></div><div class="updated" data-v-5c96fb00><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"ai-api.md\":\"5c315cc8\",\"api.md\":\"8a5273ca\",\"audio-api.md\":\"1d5aa4de\",\"build.md\":\"2e248cca\",\"changelog-dev.md\":\"16427c3c\",\"changelog.md\":\"9478b91c\",\"doc-audio.md\":\"dbbf51f3\",\"doc-playback.md\":\"646d5eb9\",\"doc-talk.md\":\"f15d4b7d\",\"doc.md\":\"b82c37fa\",\"index.md\":\"e65248ff\",\"multi-api.md\":\"3ace59e5\",\"playback-api.md\":\"6dc734e7\",\"question-audio.md\":\"677fdbda\",\"question-playback.md\":\"eba78a88\",\"question-talk.md\":\"00c27080\",\"question.md\":\"9d35ef7e\",\"talk-api.md\":\"ac85f09f\",\"upgrade.md\":\"321af037\"}")</script>
    <script type="module" async src="/assets/app.6846a517.js"></script>
  </body>
</html>