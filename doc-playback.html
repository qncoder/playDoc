<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>录像流技术方案 | JessibucaPro Doc</title>
    <meta name="description" content="一款纯H5直播流播放器">
    <link rel="stylesheet" href="/assets/style.e3f468c3.css">
    <link rel="modulepreload" href="/assets/plugin-vue_export-helper.2d87e7a1.js">
    <link rel="modulepreload" href="/assets/Home.6a91b213.js">
    <link rel="modulepreload" href="/assets/doc-playback.md.646d5eb9.lean.js">
    <link rel="modulepreload" href="/assets/app.6846a517.js">
    <meta name="twitter:title" content="录像流技术方案 | JessibucaPro Doc">
    <meta property="og:title" content="录像流技术方案 | JessibucaPro Doc">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="JessibucaPro Doc, back to home" data-v-40587210 data-v-7ac13a1e><!----> JessibucaPro Doc</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-640fc9fc><!--[--><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/api.html" data-v-49fe041d>API <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>更多API</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/playback-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>playback-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/audio-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>audio-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/multi-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>multi-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/talk-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>talk-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/ai-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>ai-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>业务方案</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/doc.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音视频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/doc-playback.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>回放流/录像流</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-audio.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-talk.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>语音通讯</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>问题解答</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音视频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-playback.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>回放流/录像流</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-audio.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-talk.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>语音通讯</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/upgrade.html" data-v-49fe041d>升级 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/build.html" data-v-49fe041d>项目打包 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/changelog.html" data-v-49fe041d>更新日志 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-640fc9fc><!--[--><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/api.html" data-v-49fe041d>API <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>更多API</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/playback-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>playback-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/audio-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>audio-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/multi-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>multi-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/talk-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>talk-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/ai-api.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>ai-API</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>业务方案</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/doc.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音视频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/doc-playback.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>回放流/录像流</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-audio.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/doc-talk.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>语音通讯</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-dropdown-link" data-v-640fc9fc data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>问题解答</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音视频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-playback.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>回放流/录像流</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-audio.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>音频播放器</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/question-talk.html" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>语音通讯</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/upgrade.html" data-v-49fe041d>升级 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/build.html" data-v-49fe041d>项目打包 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-49fe041d><a class="item" href="/changelog.html" data-v-49fe041d>更新日志 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-17c48e2f><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#录像流技术方案">录像流技术方案</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#录像流集成建议">录像流集成建议</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置硬解码（wcs、mse）">配置硬解码（wcs、mse）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_24h时间进度条">24H时间进度条</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#_24小时ui配置">24小时UI配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_24小时ui点击事件（seek）">24小时UI点击事件（seek）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_24小时ui配置（更新）开始时间">24小时UI配置（更新）开始时间</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#固定时长进度条">固定时长进度条</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#固定时长ui配置">固定时长UI配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#固定时长ui点击事件（seek）">固定时长UI点击事件（seek）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#固定时长ui配置（更新）开始时间">固定时长UI配置（更新）开始时间</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#暂停">暂停</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#暂停（不关闭流）">暂停（不关闭流）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#暂停（关闭流）">暂停（关闭流）</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#倍率">倍率</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#倍率播放">倍率播放</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#倍率播放（配置了rateconfig-参数）">倍率播放（配置了rateConfig 参数）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#固定倍率播放">固定倍率播放</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#其他">其他</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#seek操作（配合ui）">seek操作（配合UI）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#解码前缓存数据">解码前缓存数据</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#监听当前缓存情况（需要通知服务器端暂停推流）">监听当前缓存情况（需要通知服务器端暂停推流）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#使用播放器本地时间戳回调时间（从0-开始那种）">使用播放器本地时间戳回调时间（从0 开始那种）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#当前录像流的播放时间">当前录像流的播放时间</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置i帧解码">配置I帧解码</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#播放结束">播放结束</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#希望playbackpause-playbackresume-方法不要清除缓存">希望playbackPause() -&gt; playbackResume() 方法不要清除缓存</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h2 id="录像流技术方案"><a class="header-anchor" href="#录像流技术方案" aria-hidden="true">#</a> 录像流技术方案</h2><p>目前录像流支持</p><ol><li>wasm（simd）软解码 + canvas（webgl/webgpu）渲染</li><li>wcs硬解码+ canvas（webgl）渲染</li></ol><h2 id="录像流集成建议"><a class="header-anchor" href="#录像流集成建议" aria-hidden="true">#</a> 录像流集成建议</h2><p>涉及到录像流的 api 有：</p><ul><li>playback(url,options)</li><li>playbackPause(isPause)</li><li>pause()</li><li>playbackResume()</li><li>forward()</li><li>normal()</li><li>updatePlaybackForwardMaxRateDecodeIFrame(rate)</li><li>setPlaybackStartTime(timestamp)</li><li>getPlaybackCurrentRate()</li><li>playbackClearCacheBuffer()</li><li>isPlaybackPause()</li><li>updatePlaybackLocalOneFrameTimestamp()</li><li>setPlaybackShowPrecision(showPrecision)</li><li>playbackCurrentTimeScroll()</li></ul><p>涉及到录像流的 事件 有：</p><ul><li>playbackSeek</li><li>playbackStats</li><li>playbackTimestamp</li><li>playbackPauseOrResume</li><li>playbackPreRateChange</li><li>playbackRateChange</li><li>playbackRateChange</li></ul><p>具体集成的demo 可以看 <code>playback-demo.html</code>文件</p><p>调用的是<code>playback</code>方法。</p><div class="language-js"><pre><code>jessibuca<span class="token punctuation">.</span><span class="token function">playback</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// config</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="配置硬解码（wcs、mse）"><a class="header-anchor" href="#配置硬解码（wcs、mse）" aria-hidden="true">#</a> 配置硬解码（wcs、mse）</h2><p>目前播放器支持回放流使用wcs、mse硬解码</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">playback</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// 其他参数</span>
    <span class="token literal-property property">useMSE</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 使用mse解码</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">playback</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// 其他参数</span>
    <span class="token literal-property property">useWCS</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 使用wcs解码</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_24h时间进度条"><a class="header-anchor" href="#_24h时间进度条" aria-hidden="true">#</a> 24H时间进度条</h2><h3 id="_24小时ui配置"><a class="header-anchor" href="#_24小时ui配置" aria-hidden="true">#</a> 24小时UI配置</h3><p>录像流支持配置24小时组件(支持放大和缩小)和倍率按钮</p><p>对于配置参数</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">playbackConfig</span><span class="token punctuation">(</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">playList</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">16538416340000</span><span class="token punctuation">,</span>
            <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">16538434200000</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">1653881963</span><span class="token punctuation">,</span><span class="token comment">// 会自动补齐最后四个0</span>
            <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">1653885397</span> <span class="token comment">// 会自动补齐最后四个0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>未匹配到的时间，在ui上面是不可触发点击事件的。</p></blockquote><h3 id="_24小时ui点击事件（seek）"><a class="header-anchor" href="#_24小时ui点击事件（seek）" aria-hidden="true">#</a> 24小时UI点击事件（seek）</h3><p>当点击了ui上面的时间，会触发<code>playbackSeek</code>事件，可以监听这个事件，来进行业务逻辑处理。</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;playbackSeek&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// data 为对象</span>
    <span class="token comment">/**
     * {
        &quot;hour&quot;: 1,
        &quot;min&quot;: 2,
        &quot;second&quot;: 0
        }
     */</span>

    <span class="token comment">// 拿到时间，去调用服务器端的seek接口</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>业务代码可以根据回调的数据，来进行通知服务器端进行seek 操作。</p><p>当服务器端更新完了流，可以调用<code>setPlaybackStartTime</code>方法，来更新ui的时间。</p><p>总体流程： 点击ui获取时间-&gt;调用服务器端seek接口-&gt;服务器端更新流-&gt;调用<code>setPlaybackStartTime</code>方法更新ui时间</p><blockquote><p>setPlaybackStartTime的参数是时间戳，单位是秒。指的是当天的时间戳。播放器拿到这个时候，会转换成 时 分 秒， 然后会更新UI 上面的当前时间。</p></blockquote><p>例如 需要更新的时间是3:10:10</p><div class="language-js"><pre><code><span class="token comment">// 3:10:10</span>
<span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setHours</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
jessibucaPro<span class="token punctuation">.</span><span class="token function">setPlaybackStartTime</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>ui 也支持更新当前的进度时间</p></blockquote><h4 id="特殊场景"><a class="header-anchor" href="#特殊场景" aria-hidden="true">#</a> 特殊场景</h4><p>会存在一种场景，就是seek之后，流媒体服务器端还有一小戳的seek之前的数据推给前端，因为前端24H UI 上面的时间戳是根据流里面的时间戳做<code>当对值</code>得到的。</p><p>所以如果立马触发<code>setPlaybackStartTime</code>方法的话，会就有可能因为还是seek之前的时间戳，等seek之后的时间戳到来的时候，UI上面的时间会直接跳的不对。</p><p>解决方案：延迟些时间去触发<code>setPlaybackStartTime</code>方法。大概500ms左右。</p><div class="language-js"><pre><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    jessibucaPro<span class="token punctuation">.</span><span class="token function">setPlaybackStartTime</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_24小时ui配置（更新）开始时间"><a class="header-anchor" href="#_24小时ui配置（更新）开始时间" aria-hidden="true">#</a> 24小时UI配置（更新）开始时间</h3><p>在录播流播放模式下，底部的开始时间是从<code>playList[0].start</code>开始的。</p><p>如果想要配置指定的开始时间，可以在<code>playback(config)</code> 配置下<code>config.startTime</code> 参数即可。</p><p>所以，如果需要配置开始时间，可以调用<code>setPlaybackStartTime</code>方法。</p><div class="language-js"><pre><code>
<span class="token comment">// 3:10:10</span>
<span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setHours</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
jessibucaPro<span class="token punctuation">.</span><span class="token function">setPlaybackStartTime</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
</code></pre></div><p>这样配置了之后，UI上面的开始时间就是从3:10:10开始一秒一秒的走。</p><blockquote><p>同样的在触发<code>seek</code>事件的时候，需要在ui上面更新开始时间，也是调用这个方法。</p></blockquote><h2 id="固定时长进度条"><a class="header-anchor" href="#固定时长进度条" aria-hidden="true">#</a> 固定时长进度条</h2><h3 id="固定时长ui配置"><a class="header-anchor" href="#固定时长ui配置" aria-hidden="true">#</a> 固定时长UI配置</h3><p>只需要配置<code>playbackConfig</code>的<code>controlType</code> 字段为 <code>simple</code>即可</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">playbackConfig</span><span class="token punctuation">(</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">controlType</span><span class="token operator">:</span> <span class="token string">&#39;simple&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>时长</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">playbackConfig</span><span class="token punctuation">(</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token comment">// 1小时</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="固定时长ui点击事件（seek）"><a class="header-anchor" href="#固定时长ui点击事件（seek）" aria-hidden="true">#</a> 固定时长UI点击事件（seek）</h3><p>当点击了ui上面的时间，会触发<code>playbackSeek</code>事件，可以监听这个事件，来进行业务逻辑处理。</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;playbackSeek&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// data 为对象</span>
    <span class="token comment">/**
     * {
        ts:100 // 秒单位
        }
     */</span>

    <span class="token comment">// 拿到时间，去调用服务器端的seek接口</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="固定时长ui配置（更新）开始时间"><a class="header-anchor" href="#固定时长ui配置（更新）开始时间" aria-hidden="true">#</a> 固定时长UI配置（更新）开始时间</h3><p>在录播流播放模式下，底部的开始时间是从<code>0</code>开始的。</p><p>所以，如果需要配置开始时间，可以调用<code>setPlaybackStartTime</code>方法。</p><div class="language-js"><pre><code>
<span class="token comment">// 比如要到1:30 位置</span>
<span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> <span class="token number">30</span>
jessibucaPro<span class="token punctuation">.</span><span class="token function">setPlaybackStartTime</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
</code></pre></div><p>这样配置了之后，UI上面的开始时间就是从1:30开始一秒一秒的走。</p><blockquote><p>同样的在触发<code>seek</code>事件的时候，需要在ui上面更新开始时间，也是调用这个方法。</p></blockquote><h2 id="暂停"><a class="header-anchor" href="#暂停" aria-hidden="true">#</a> 暂停</h2><h3 id="暂停（不关闭流）"><a class="header-anchor" href="#暂停（不关闭流）" aria-hidden="true">#</a> 暂停（不关闭流）</h3><blockquote><p>会存在业务上面的录像流暂停，但是不关闭流的需求，这个时候可以调用播放器的<code>playbackPause()</code>方法，来暂停播放。</p></blockquote><blockquote><p>暂停的时候会把缓存的数据清空。所以如果不清除缓存可以设置参数<code>isPlaybackPauseClearCache:false</code>。</p></blockquote><ol><li>调用服务器端暂停接口</li><li>调用播放器的<code>playbackPause()</code>方法，画面暂停</li><li>调用服务器端恢复接口</li><li>调用播放器的<code>playbackResume()</code>方法，画面播放</li></ol><h3 id="暂停（关闭流）"><a class="header-anchor" href="#暂停（关闭流）" aria-hidden="true">#</a> 暂停（关闭流）</h3><p>可以调用 <code>playbackPause(true)</code> 或者 <code>pause()</code> 方法。</p><h2 id="倍率"><a class="header-anchor" href="#倍率" aria-hidden="true">#</a> 倍率</h2><h3 id="倍率播放"><a class="header-anchor" href="#倍率播放" aria-hidden="true">#</a> 倍率播放</h3><ol><li>首先调用服务器端接口，开启倍率播放</li><li>调用播放器的<code>forward(rate)</code>方法</li><li>关闭倍率播放，调用服务器端接口</li><li>调用播放器的<code>forward(1)</code>或者<code>normal()</code>方法</li></ol><h3 id="倍率播放（配置了rateconfig-参数）"><a class="header-anchor" href="#倍率播放（配置了rateconfig-参数）" aria-hidden="true">#</a> 倍率播放（配置了rateConfig 参数）</h3><ol><li>首先选择UI上面的倍率按钮，配合<code>playbackPreRateChange</code>事件，拿到倍率，</li><li>调用服务器端接口，开启倍率播放。</li><li>调用播放器的<code>forward(rate)</code>方法。</li></ol><h3 id="固定倍率播放"><a class="header-anchor" href="#固定倍率播放" aria-hidden="true">#</a> 固定倍率播放</h3><blockquote><p>会存在一些流，服务器端的录像流的推过来的fps不是定码率的，是波动性比较大的那种，这个时候就需要客户端去按照固定倍率去播放。</p></blockquote><p>则需要配置使用固定fps进行渲染，并配置 fps 值。默认值是 <code>25</code></p><div class="language-"><pre><code>playbackConfig:{
    isUseFpsRender:true,
    fps: &#39;&#39;, // fps值
}
</code></pre></div><p>可能会存在fps 设置的不对的情况，所以播放器也会去校正这个参数。</p><blockquote><p>播放器也会根据流的时间戳来计算出准确的<code>fps</code>大小，并更新到<code>fps</code>参数上面去。</p></blockquote><h2 id="其他"><a class="header-anchor" href="#其他" aria-hidden="true">#</a> 其他</h2><h3 id="seek操作（配合ui）"><a class="header-anchor" href="#seek操作（配合ui）" aria-hidden="true">#</a> seek操作（配合UI）</h3><ol><li>点击时间轴UI，监听<code>playbackSeek</code>获取时间</li><li>调用服务器端seek接口</li><li>服务器端更新流</li><li>调用<code>setPlaybackStartTime</code>方法，更新ui时间</li></ol><h3 id="解码前缓存数据"><a class="header-anchor" href="#解码前缓存数据" aria-hidden="true">#</a> 解码前缓存数据</h3><blockquote><p>会存在有些流，一倍率的时候，但是服务器端推送的流是2倍的，这个时候就需要播放器兼容这种特殊的流，只解码所需的1倍率的数据。</p></blockquote><p>可以通过在调用playback方法播放的时候，config配置参数里面配置<code>isCacheBeforeDecodeForFpsRender</code> 参数</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">playback</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">isCacheBeforeDecodeForFpsRender</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="监听当前缓存情况（需要通知服务器端暂停推流）"><a class="header-anchor" href="#监听当前缓存情况（需要通知服务器端暂停推流）" aria-hidden="true">#</a> 监听当前缓存情况（需要通知服务器端暂停推流）</h3><p>目前播放器的缓存数据有，<code>待解码</code>，<code>解码后待渲染</code> 两块缓存数据，单位帧。</p><blockquote><p>待解码缓存数据，是指，从服务器端获取到的数据，还没有解码的数据。</p><p>解码后待渲染缓存数据，是指，解码后的数据，还没有渲染的数据。</p></blockquote><p>可以通过监听<code>stats</code>事件，来获取当前的缓存数据。</p><p><code>playbackVideoBuffer</code> 指的是<code>视频待渲染</code>帧。</p><p><code>demuxBuffer</code> 指的是<code>视频待渲染</code>帧。</p><p>可以通过<code>stats</code> 事件里面的fps 来计算出每一帧的时间，然后计算出缓存的时间。</p><p>假设fps 为25，那么每一帧的时间就是 1000 / 25 = 40ms。</p><p>如果<code>playbackVideoBuffer</code> 为100，那么缓存的时间就是 100 * 40 = 4000ms = 4s。如果<code>demuxBuffer</code> 为100，那么缓存的时间就是 100</p><ul><li>40 = 4000ms = 4s。 那么一起的缓存时长就是 4 + 4 = 8s</li></ul><blockquote><p>stats 事件里面已经添加了 <code>playbackCacheDataDuration</code>值。</p></blockquote><h3 id="使用播放器本地时间戳回调时间（从0-开始那种）"><a class="header-anchor" href="#使用播放器本地时间戳回调时间（从0-开始那种）" aria-hidden="true">#</a> 使用播放器本地时间戳回调时间（从0 开始那种）</h3><blockquote><p>存在一些流，流里面的时间戳不是从 0 开始的，这个时候，如果录像流想要从0 开始回调时间。</p></blockquote><p>这个时候就需要配置 <code>playbackConfig</code> 参数</p><div class="language-"><pre><code>playbackConfig:{
    isUseLocalCalculateTime:true, // 是否使用本地时间来计算playback时间
    localOneFrameTimestamp:40 // 一帧的间隔时间戳 40ms  100 / 25 = 40ms
}
</code></pre></div><p>业务层通过监听<code>playbackTime</code>，<code>playbackTimestamp</code> 事件，可以监听到当前播放的时间。</p><h3 id="当前录像流的播放时间"><a class="header-anchor" href="#当前录像流的播放时间" aria-hidden="true">#</a> 当前录像流的播放时间</h3><p>可以监听<code>playbackTimestamp</code>事件，来获取当前播放的时间。</p><div class="language-js"><pre><code>jessibucaPro<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;playbackTimestamp&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// data 为对象</span>
    <span class="token comment">/**
     * {
        &quot;hour&quot;: 1,
        &quot;min&quot;: 2,
        &quot;second&quot;: 0,
        &quot;ts&quot;: &quot;&quot; // 时间戳
        }
     */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="配置i帧解码"><a class="header-anchor" href="#配置i帧解码" aria-hidden="true">#</a> 配置I帧解码</h3><blockquote><p>过滤掉其他帧，只解码I帧，可以提高播放性能。</p></blockquote><p>当倍率达到播放器性能瓶颈的时候，就需要配置I帧解码，来提高播放性能。</p><p>可以通过调用<code>updatePlaybackForwardMaxRateDecodeIFrame</code>方法，来配置I帧解码。</p><blockquote><p>播放器默认I帧解码的倍率是4倍。</p></blockquote><div class="language-js"><pre><code><span class="token comment">// 当倍率达到3倍的时候，就触发i帧解码。</span>
jessibucaPro<span class="token punctuation">.</span><span class="token function">updatePlaybackForwardMaxRateDecodeIFrame</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>支持在播放前后调用，</p></blockquote><h3 id="播放结束"><a class="header-anchor" href="#播放结束" aria-hidden="true">#</a> 播放结束</h3><p>因为播放器播放的是流，所以播放器并不知道这个流的结束时间是多少。</p><blockquote><p>播放器唯一能做的就是监听超时。</p></blockquote><p>需要业务层自己结合后端接口来实现。</p><h3 id="希望playbackpause-playbackresume-方法不要清除缓存"><a class="header-anchor" href="#希望playbackpause-playbackresume-方法不要清除缓存" aria-hidden="true">#</a> 希望playbackPause() -&gt; playbackResume() 方法不要清除缓存</h3><p>暂停-&gt;恢复的时候，支持从暂停的时间点开始继续播放。</p><blockquote><p>目前只支持wasm软解码。</p></blockquote><p>需要配置</p><div class="language-"><pre><code>isPlaybackPauseClearCache:false; // playbackPause是否清除缓存数据
isCacheBeforeDecodeForFpsRender:true; // 是否在解码前缓存数据
isUseFpsRender:true // 是否使用固定的fps渲染
</code></pre></div></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><!----></div></div><div class="updated" data-v-5c96fb00><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"ai-api.md\":\"5c315cc8\",\"api.md\":\"8a5273ca\",\"audio-api.md\":\"1d5aa4de\",\"build.md\":\"2e248cca\",\"changelog-dev.md\":\"16427c3c\",\"changelog.md\":\"9478b91c\",\"doc-audio.md\":\"dbbf51f3\",\"doc-playback.md\":\"646d5eb9\",\"doc-talk.md\":\"f15d4b7d\",\"doc.md\":\"b82c37fa\",\"index.md\":\"e65248ff\",\"multi-api.md\":\"3ace59e5\",\"playback-api.md\":\"6dc734e7\",\"question-audio.md\":\"677fdbda\",\"question-playback.md\":\"eba78a88\",\"question-talk.md\":\"00c27080\",\"question.md\":\"9d35ef7e\",\"talk-api.md\":\"ac85f09f\",\"upgrade.md\":\"321af037\"}")</script>
    <script type="module" async src="/assets/app.6846a517.js"></script>
  </body>
</html>